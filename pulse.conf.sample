# PulseOS configuration file (template)
# Copy this to: /opt/pulse-os/pulse.conf

# ============================================================================
# Core Configuration
# ============================================================================

# PULSE_VERSION derived from VERSION file located next to this config.
if [[ -z "${PULSE_VERSION:-}" ]]; then
  _pulse_conf_dir="$(cd "$(dirname "${BASH_SOURCE[0]:-${0}}")" && pwd)"
  _pulse_version_file="${_pulse_conf_dir}/VERSION"
  if [[ -f "${_pulse_version_file}" ]]; then
    PULSE_VERSION="$(tr -d '\n\r ' < "${_pulse_version_file}")"
  else
    PULSE_VERSION="0.0.0"
  fi
  unset _pulse_conf_dir _pulse_version_file
fi

# PULSE_USER â€” Linux account that auto-logs in and runs Pulse services.
PULSE_USER="pulse"

# ============================================================================
# Kiosk & Browser
# ============================================================================

# PULSE_URL â€” Chromium kiosk landing page opened after boot.
PULSE_URL="http://homeassistant.local:8123/photo-frame/home?sidebar=hide"

# PULSE_REVIVE_INTERVAL â€” minutes between watchdog cron runs that restart the kiosk if needed.
PULSE_REVIVE_INTERVAL=2

# PULSE_WATCHDOG_URL â€” lightweight URL Chromium fetches to prove connectivity.
PULSE_WATCHDOG_URL="http://homeassistant.local:8123/static/icons/favicon.ico"

# PULSE_WATCHDOG_LIMIT â€” failed watchdog fetches before we restart the browser.
PULSE_WATCHDOG_LIMIT=5

# PULSE_WATCHDOG_INTERVAL â€” seconds between watchdog fetches.
PULSE_WATCHDOG_INTERVAL=60

# CHROMIUM_DEVTOOLS_URL â€” DevTools discovery endpoint for kiosk navigation/debug (default points to local Chromium).
CHROMIUM_DEVTOOLS_URL="http://localhost:9222/json"

# CHROMIUM_DEVTOOLS_TIMEOUT â€” timeout (seconds) for DevTools HTTP/WebSocket calls.
CHROMIUM_DEVTOOLS_TIMEOUT=3

# ============================================================================
# Overlay & Photo Frame
# ============================================================================

# PULSE_OVERLAY_ENABLED â€” enable the kiosk-hosted overlay HTML endpoint.
PULSE_OVERLAY_ENABLED="true"

# PULSE_OVERLAY_PORT â€” TCP port the overlay HTTP server listens on (default 8800).
PULSE_OVERLAY_PORT="8800"

# PULSE_OVERLAY_BIND â€” bind address for the overlay server (0.0.0.0 for all interfaces).
PULSE_OVERLAY_BIND="0.0.0.0"

# PULSE_OVERLAY_ALLOWED_ORIGINS â€” comma-separated list of allowed CORS origins (â€œ*â€ allows all).
PULSE_OVERLAY_ALLOWED_ORIGINS="*"

# PULSE_OVERLAY_CLOCK â€” optional clock timezone and label
# Example: PULSE_OVERLAY_CLOCK="local=ðŸ’“ Bedroom" or "America/Chicago=Office"
# If unset, defaults to local timezone with the device friendly name as label.
PULSE_OVERLAY_CLOCK=""

# PULSE_OVERLAY_AMBIENT_BG â€” CSS color for persistent cards (clocks, now playing).
PULSE_OVERLAY_AMBIENT_BG="rgba(0, 0, 0, 0.32)"

# PULSE_OVERLAY_ALERT_BG â€” CSS color for alert cards (timers, alarms).
PULSE_OVERLAY_ALERT_BG="rgba(0, 0, 0, 0.65)"

# PULSE_OVERLAY_TEXT_COLOR â€” primary overlay text color.
PULSE_OVERLAY_TEXT_COLOR="#FFFFFF"

# PULSE_OVERLAY_ACCENT_COLOR â€” accent color for titles and highlights.
PULSE_OVERLAY_ACCENT_COLOR="#88C0D0"

# PULSE_OVERLAY_NOTIFICATION_BAR â€” show the icon bar at the top of the overlay.
PULSE_OVERLAY_NOTIFICATION_BAR="true"

# PULSE_OVERLAY_CLOCK_24H â€” set to "true" for 24-hour clock display (default 12-hour).
PULSE_OVERLAY_CLOCK_24H="false"

# ============================================================================
# Telemetry & MQTT
# ============================================================================

# MQTT_HOST â€” hostname/IP of the MQTT broker Pulse publishes to.
MQTT_HOST="mosquitto.local"

# MQTT_PORT â€” MQTT broker port (defaults to 1883).
MQTT_PORT="1883"

# PULSE_VERSION_CHECKS_PER_DAY â€” how many times per day we poll for new PulseOS releases (2/4/6/8/12/24).
PULSE_VERSION_CHECKS_PER_DAY=12

# PULSE_TELEMETRY_INTERVAL_SECONDS â€” seconds between telemetry MQTT publishes (minimum 5s).
PULSE_TELEMETRY_INTERVAL_SECONDS=15

# ============================================================================
# Device Preferences & Toggles
# ============================================================================

# PULSE_DAY_NIGHT_AUTO â€” automatically adjust screen brightness for sunrise/sunset; set to "false" for manual control.
PULSE_DAY_NIGHT_AUTO="true"

# PULSE_VOLUME_TEST_SOUND â€” plays the heartbeat "thump-thump" after MQTT volume changes.
PULSE_VOLUME_TEST_SOUND="true"

# PULSE_BLUETOOTH_AUTOCONNECT â€” automatically reconnect to the last paired Bluetooth audio device and send keepalives.
PULSE_BLUETOOTH_AUTOCONNECT="true"

# PULSE_BT_MAC â€” optional Bluetooth MAC (XX:XX:XX:XX:XX:XX) to force which device we connect to.
PULSE_BT_MAC=""

# ============================================================================
# Logging & Reliability
# ============================================================================

# PULSE_REMOTE_LOGGING â€” enable remote syslog forwarding.
PULSE_REMOTE_LOGGING="true"

# PULSE_REMOTE_LOG_HOST â€” remote syslog server hostname/IP.
PULSE_REMOTE_LOG_HOST="192.168.1.100"

# PULSE_REMOTE_LOG_PORT â€” remote syslog server port.
PULSE_REMOTE_LOG_PORT="5514"

# PULSE_REBOOT_MIN_UPTIME_SECONDS â€” minimum uptime (seconds) before an automatic reboot is allowed.
PULSE_REBOOT_MIN_UPTIME_SECONDS="300"

# PULSE_REBOOT_WINDOW_SECONDS â€” rolling window (seconds) for counting automatic reboots.
PULSE_REBOOT_WINDOW_SECONDS="900"

# PULSE_REBOOT_MAX_COUNT â€” maximum automatic reboots inside that rolling window.
PULSE_REBOOT_MAX_COUNT="3"

# ============================================================================
# Voice Assistant (Wyoming + LLM)
# ============================================================================

# --- Pipeline & routing -----------------------------------------------------
# PULSE_VOICE_ASSISTANT â€” enable the wake word/STT/TTS stack that talks to your Wyoming servers.
PULSE_VOICE_ASSISTANT="false"

# PULSE_ASSISTANT_WAKE_WORDS_PULSE â€” comma-separated wyoming-openwakeword models handled by the local â€œPulseâ€ pipeline.
PULSE_ASSISTANT_WAKE_WORDS_PULSE="hey_jarvis"

# PULSE_ASSISTANT_WAKE_WORDS_HA â€” models that should route audio through Home Assistant Assist instead of the Pulse pipeline.
PULSE_ASSISTANT_WAKE_WORDS_HA="hey_house"

# PULSE_ASSISTANT_WAKE_ROUTES â€” optional explicit mapping (model=pipeline) to override the defaults above.
# PULSE_ASSISTANT_WAKE_ROUTES="hey_jarvis=pulse,hey_house=home_assistant"
# PULSE_ASSISTANT_LANGUAGE â€” optional language hint passed to the STT engine and LLM.
PULSE_ASSISTANT_LANGUAGE="en"

# PULSE_ASSISTANT_WAKE_SOUND â€” chime when a wake word fires (set to "false" for silent wakes).
PULSE_ASSISTANT_WAKE_SOUND="true"

# PULSE_ASSISTANT_SPEAKING_STYLE â€” persona hint for the Pulse pipeline (relaxed, normal, aggressive).
PULSE_ASSISTANT_SPEAKING_STYLE="normal"

# PULSE_ASSISTANT_WAKE_SENSITIVITY â€” maps to openWakeWord trigger levels (low=5, normal=3, high=2).
PULSE_ASSISTANT_WAKE_SENSITIVITY="normal"

# PULSE_ASSISTANT_SELF_AUDIO_TRIGGER_LEVEL â€” enforced trigger level while self audio is active (minimum 2).
PULSE_ASSISTANT_SELF_AUDIO_TRIGGER_LEVEL="7"

# --- Wyoming endpoints ------------------------------------------------------
# WYOMING_WHISPER_HOST â€” hostname/IP of your wyoming-whisper (speech-to-text) server.
WYOMING_WHISPER_HOST=""

# WYOMING_WHISPER_PORT â€” TCP port exposed by wyoming-whisper (default 10300).
WYOMING_WHISPER_PORT="10300"

# WYOMING_PIPER_HOST â€” hostname/IP of your wyoming-piper (text-to-speech) server.
WYOMING_PIPER_HOST=""

# WYOMING_PIPER_PORT â€” TCP port exposed by wyoming-piper (default 10200).
WYOMING_PIPER_PORT="10200"

# WYOMING_OPENWAKEWORD_HOST â€” hostname/IP of your wyoming-openwakeword detector.
WYOMING_OPENWAKEWORD_HOST=""

# WYOMING_OPENWAKEWORD_PORT â€” TCP port exposed by wyoming-openwakeword (default 10400).
WYOMING_OPENWAKEWORD_PORT="10400"

# --- Mic capture & phrase detection ----------------------------------------
# PULSE_ASSISTANT_MIC_CMD â€” ALSA command used to stream 16 kHz mono PCM into the pipeline.
PULSE_ASSISTANT_MIC_CMD="arecord -q -t raw -f S16_LE -c 1 -r 16000 -"

# PULSE_ASSISTANT_MIN_PHRASE_SECONDS â€” minimum captured speech (seconds) before we consider it a phrase.
PULSE_ASSISTANT_MIN_PHRASE_SECONDS=1.5

# PULSE_ASSISTANT_MAX_PHRASE_SECONDS â€” cap on phrase duration before we auto-stop recording.
PULSE_ASSISTANT_MAX_PHRASE_SECONDS=8

# PULSE_ASSISTANT_SILENCE_MS â€” milliseconds of silence that signal end-of-phrase.
PULSE_ASSISTANT_SILENCE_MS=1200

# PULSE_ASSISTANT_RMS_THRESHOLD â€” RMS floor used to ignore background noise.
PULSE_ASSISTANT_RMS_THRESHOLD=120

# --- LLM provider -----------------------------------------------------------
# PULSE_ASSISTANT_PROVIDER â€” LLM backend slug; defaults to "openai".
PULSE_ASSISTANT_PROVIDER="openai"
# Publish "openai" or "gemini" to pulse/<hostname>/preferences/llm_provider/set (or use the HA select)
# to change providers at runtime without editing this file.

# OPENAI_API_KEY â€” API key used when the provider is OpenAI (leave blank for other providers).
OPENAI_API_KEY=""

# OPENAI_MODEL â€” OpenAI chat/completions model to call for the Pulse pipeline.
OPENAI_MODEL="gpt-4o-mini"

# OPENAI_BASE_URL â€” override if you proxy OpenAI-compatible requests through another endpoint.
OPENAI_BASE_URL="https://api.openai.com/v1"

# OPENAI_TIMEOUT_SECONDS â€” request timeout for OpenAI API calls (seconds).
OPENAI_TIMEOUT_SECONDS=45

# GEMINI_API_KEY â€” API key when the provider is set to "gemini".
GEMINI_API_KEY=""

# GEMINI_MODEL â€” Gemini model to call when using Googleâ€™s Generative Language API.
GEMINI_MODEL="gemini-1.5-flash-latest"

# GEMINI_BASE_URL â€” override if you proxy Gemini requests through another endpoint.
GEMINI_BASE_URL="https://generativelanguage.googleapis.com/v1beta"

# GEMINI_TIMEOUT_SECONDS â€” request timeout for Gemini API calls (seconds).
GEMINI_TIMEOUT_SECONDS=45

# --- Prompting, automations & TTS -------------------------------------------
# PULSE_ASSISTANT_SYSTEM_PROMPT="You are a friendly desk assistant..."
# PULSE_ASSISTANT_SYSTEM_PROMPT_FILE="/opt/pulse-os/prompt.txt"
# PULSE_ASSISTANT_TTS_VOICE â€” preferred Piper voice (leave blank to use server default).
PULSE_ASSISTANT_TTS_VOICE=""

# PULSE_ASSISTANT_ACTIONS_FILE â€” JSON file describing MQTT/HA action slugs (slug, description, topic, payload).
PULSE_ASSISTANT_ACTIONS_FILE="/opt/pulse-os/pulse-assistant-actions.json"

# PULSE_ASSISTANT_ACTIONS â€” inline JSON string with the same schema as the file above.
# PULSE_ASSISTANT_ACTIONS='[{"slug":"desk_lights_on","description":"Turn on desk lights","topic":"home/desk/lights/set","payload":{"state":"ON"}}]'

# --- On-screen responses ----------------------------------------------------
# PULSE_ASSISTANT_DISPLAY_SECONDS â€” how long the Tk response overlay should stay visible.
PULSE_ASSISTANT_DISPLAY_SECONDS=8

# PULSE_ASSISTANT_FONT_SIZE â€” response overlay font size (pixels).
PULSE_ASSISTANT_FONT_SIZE=28

# PULSE_DISPLAY_SHOW_NOW_PLAYING â€” show Home Assistant media metadata on the overlay.
PULSE_DISPLAY_SHOW_NOW_PLAYING="false"

# PULSE_DISPLAY_NOW_PLAYING_INTERVAL_SECONDS â€” how often to refresh metadata from HA (seconds).
PULSE_DISPLAY_NOW_PLAYING_INTERVAL_SECONDS=5

# PULSE_MEDIA_PLAYER_ENTITY â€” HA media_player (or sensor) that represents this kioskâ€™s audio output.
# Used by the on-screen overlay, MQTT telemetry, and to auto-pause/resume Music Assistant during wake-word interactions.
# Defaults to media_player.<hostname>_2 when left blank.
PULSE_MEDIA_PLAYER_ENTITY=""

# ============================================================================
# Snapcast Client (optional)
# ============================================================================

# --- Core settings ---------------------------------------------------------
# PULSE_SNAPCLIENT â€” run snapclient so this Pulse shows up as a Snapcast player.
PULSE_SNAPCLIENT="false"

# PULSE_SNAPCAST_HOST â€” hostname/IP of your Snapserver instance.
PULSE_SNAPCAST_HOST=""

# PULSE_SNAPCAST_PORT â€” Snapserver PCM stream port (default 1704).
PULSE_SNAPCAST_PORT="1704"

# PULSE_SNAPCAST_CONTROL_PORT â€” Snapserver control channel port (default 1705).
PULSE_SNAPCAST_CONTROL_PORT="1705"

# --- Audio routing & tuning ------------------------------------------------
# PULSE_SNAPCLIENT_SOUNDCARD â€” snapclient --soundcard target (default, pipewire, hw:0,0, etc.).
PULSE_SNAPCLIENT_SOUNDCARD="default"

# PULSE_SNAPCLIENT_LATENCY_MS â€” optional snapclient --latency override (milliseconds).
PULSE_SNAPCLIENT_LATENCY_MS=""

# PULSE_SNAPCLIENT_EXTRA_ARGS â€” additional snapclient CLI flags (space-separated).
# Defaults to "--player pulse" so audio routes through PipeWire/Pulse.
PULSE_SNAPCLIENT_EXTRA_ARGS="--player pulse"

# PULSE_SNAPCLIENT_HOST_ID â€” optional friendly name override (defaults to hostname).
PULSE_SNAPCLIENT_HOST_ID=""

# ============================================================================
# Home Assistant Integration (optional)
# ============================================================================

# --- Base connection & Assist pipeline -------------------------------------
# HOME_ASSISTANT_BASE_URL â€” base URL for your Home Assistant instance (used for Assist + REST calls).
HOME_ASSISTANT_BASE_URL="http://homeassistant.local:8123"

# HOME_ASSISTANT_TOKEN â€” long-lived access token the assistant uses when calling Home Assistant APIs.
HOME_ASSISTANT_TOKEN=""

# HOME_ASSISTANT_VERIFY_SSL â€” keep "true" to verify TLS, or set "false" for self-signed certs.
HOME_ASSISTANT_VERIFY_SSL="true"

# HOME_ASSISTANT_ASSIST_PIPELINE â€” optional Assist pipeline ID to override HAâ€™s default.
HOME_ASSISTANT_ASSIST_PIPELINE=""

# --- HA-hosted Wyoming endpoints -------------------------------------------
# Leave blank to keep using the direct Wyoming servers above.
# HOME_ASSISTANT_OPENWAKEWORD_HOST â€” HA-provided wyoming-openwakeword host.
HOME_ASSISTANT_OPENWAKEWORD_HOST=""

# HOME_ASSISTANT_OPENWAKEWORD_PORT â€” HA-provided wyoming-openwakeword port.
HOME_ASSISTANT_OPENWAKEWORD_PORT=""

# HOME_ASSISTANT_WHISPER_HOST â€” HA-provided wyoming-whisper host.
HOME_ASSISTANT_WHISPER_HOST=""

# HOME_ASSISTANT_WHISPER_PORT â€” HA-provided wyoming-whisper port.
HOME_ASSISTANT_WHISPER_PORT=""

# HOME_ASSISTANT_STT_MODEL â€” optional model name to request from the HA-managed wyoming-whisper endpoint.
HOME_ASSISTANT_STT_MODEL=""

# HOME_ASSISTANT_PIPER_HOST â€” HA-provided wyoming-piper host.
HOME_ASSISTANT_PIPER_HOST=""

# HOME_ASSISTANT_PIPER_PORT â€” HA-provided wyoming-piper port.
HOME_ASSISTANT_PIPER_PORT=""

# --- Timer/reminder helpers ------------------------------------------------
# When set, the assistant calls HA services; otherwise it falls back to local timers/reminders.
# HOME_ASSISTANT_TIMER_ENTITY="timer.kitchen"
# HOME_ASSISTANT_REMINDER_SERVICE="notify.mobile_app_phone"
